async function verify1071(claimId) {
  if (!userSk) { log('Set up keys first', 'error'); return; }

  const data = openClaims[claimId];
  if (!data) return;
  const { claim, taskId } = data;
  const task = openTasks[taskId];
  const bountyMsats = task
    ? parseInt((task.tags.find(t => t[0] === 'amount') || ['','0'])[1] || '0')
    : 0;

  const event = finalizeEvent({
    kind: 1071,
    content: 'Accepted. Proof verified. Paradox resolved. ‚ö°üçÑ',
    created_at: Math.floor(Date.now() / 1000),
    tags: [
      ['e', claim.id, '', 'reply'],
      ['e', taskId, '', 'root'],
      ['p', claim.pubkey],
      ['payment', 'status', 'sent'],
    ]
  }, userSk);

  const statusEl = $('status-claim-' + claimId);
  if (statusEl) statusEl.textContent = 'Resolving‚Ä¶';

  try {
    await Promise.any(pool.publish(RELAYS, event));
    log('‚úÖ Kind 1071 published ‚Äî paradox resolved üçÑ!', 'success');

    const invoiceInput = $('inp-invoice');
    const invoice = invoiceInput ? invoiceInput.value.trim() : '';
    const simulate = $('simulate-mode').checked;

    if (simulate) {
      if (bountyMsats > 0) {
        simBalance = Math.max(0, simBalance - bountyMsats);
        setBalanceDisplay(simBalance);
        log(`‚ö° Simulated: sent ${Math.floor(bountyMsats/1000)} sats to agent üçÑ`, 'warn');
      }
      if (statusEl) statusEl.innerHTML = '<span style="color:#F59E0B">Simulated üçÑ</span>';
    } else if (nwcClient && bountyMsats > 0) {
      log(`‚ö° Sending ${Math.floor(bountyMsats/1000)} sats via NWC‚Ä¶`, 'info');
      try {
        let invoiceToPay = invoice;
        if (!invoiceToPay.startsWith('lnbc')) {
          log(`Fetching invoice from ${AGENT_LIGHTNING_ADDRESS}‚Ä¶ üçÑ`, 'info');
          const [user, domain] = AGENT_LIGHTNING_ADDRESS.split('@');
          const lnurlRes = await fetch(
            `https://${domain}/.well-known/lnurlp/${user}`
          );
          if (!lnurlRes.ok) throw new Error(`LNURL fetch failed: ${lnurlRes.status}`);
          const lnurlData = await lnurlRes.json();

          const invoiceRes = await fetch(
            `${lnurlData.callback}?amount=${bountyMsats}`
          );
          if (!invoiceRes.ok) throw new Error(`Invoice fetch failed: ${invoiceRes.status}`);
          const invoiceData = await invoiceRes.json();

          if (invoiceData.pr) {
            invoiceToPay = invoiceData.pr;
          } else {
            throw new Error('No invoice returned from LNURL');
          }
        }

        const result = await nwcClient.payInvoice({ invoice: invoiceToPay });
        log(`üí∏ Paid! Preimage: ${result.preimage?.slice(0,20)}‚Ä¶ üçÑ`, 'success');
        const info = await nwcClient.getBalance();
        simBalance = info.balance;
        setBalanceDisplay(simBalance);
        if (statusEl) statusEl.innerHTML = '<span style="color:#10B981">Paid ‚ö°üçÑ</span>';
      } catch(e) {
        log(`Payment error: ${e.message}`, 'error');
        if (statusEl) statusEl.innerHTML = '<span style="color:#EF4444">Payment failed</span>';
        return;
      }
    } else {
      log('No wallet or bounty ‚Äî payment skipped üçÑ', 'warn');
      if (statusEl) statusEl.innerHTML = '<span style="color:#F59E0B">Skipped üçÑ</span>';
    }

    const summary = {
      task: task?.content?.slice(0, 60) || 'Unknown task',
      sats: Math.floor(bountyMsats / 1000),
      eventId: event.id
    };
    resolved.push(summary);
    delete openTasks[taskId];
    delete openClaims[claimId];

    renderTasks();
    renderClaims();
    renderResolved();
    showFireworks();
  } catch(e) {
    log(`Failed to publish 1071: ${e.message}`, 'error');
    if (statusEl) statusEl.innerHTML = '<span style="color:#EF4444">Failed</span>';
  }
}
